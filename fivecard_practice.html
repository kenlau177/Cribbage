<!doctype html>

<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=0.4, maximum-scale=0.4, user-scalable=no">

  <title>Cribbage Hand Optimizer</title>

	<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
  
	<!-- Bootstrap -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

  <link href='https://fonts.googleapis.com/css?family=Great+Vibes' rel='stylesheet' type='text/css'>

  <script src="js/sweetalert.min.js"></script>
  <link rel="stylesheet" href="sweetalert.css">

  <!-- Checkbox -->
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <link rel="stylesheet" href="style.css">

</head>

<body style="margin:0px 0px 0px 0px;">
	
	<div class="container">
		<center><h2 id="title_font">Cribbage Practice</h2></center>
		<div class="row">
		  <div class="btn-group dropdown">
			  <button type="button" class="btn btn-warning dropdown-toggle" id="menu" data-toggle="dropdown">Menu</button>
		  	<ul class="dropdown-menu pull-center">
		  		<li><a href="#">About this App</a></li>
			    <li class="divider"></li>
			    <li class="divider"></li>
			    <li><a href="index.html">Optimizer</a></li>
			    <li><a href="fivecard_scorer.html">Hand Scorer</a></li>
			    <li style="background-color:#ffff66;"><a href="#">Practice</a></li>
			    <li class="divider"></li>
			    <li class="divider"></li>
			    <li style="background-color:#ffffb2;"><a href="#">5-Card Game</a></li>
			    <li><a href="#">6-Card Game</a></li>
			    <li class="divider"></li>
			    <li class="divider"></li>
			  </ul>	
			</div>
		</div>
		<hr>
		<h1>Go to:</h1>
		<a id="practice_optimization_link"><h1 class="card_title" style="margin-bottom:35px;">1) Practice Card Discarding</h1></a>
		<a id="practice_score_link"><h1 class="card_title">2) Practice Hand Scoring</h1></a>

		<center><h1 class="card_title" style="margin-top:50px;">1) Practice Card Discarding</h1></center>
		<hr>

		<h1>Begin each round by randomizing your hand.</h1>
		<br>
		<div class="row">
			<div class="btn-group" style="margin-top:0px;">
				<button id="randomize_button" type="button" class="btn btn-info" style="width:98%; margin-top:0px;">Randomize Crib Turn and Hand</button>
			</div>
		</div>

		<div class="row">
			<div class="col-md-4">
				<br>
				<center>
					<fieldset data-role="controlgroup" data-type="horizontal">
					  <label for="crib_radio1" id="crib_label1">Your Crib</label>
					  <input type="radio" name="crib_radio1" id="crib_radio1">
					  <label for="crib_radio2" id="crib_label2">Other's Crib</label>
					  <input type="radio" name="crib_radio1" id="crib_radio2">
					</fieldset>
				</center>
			</div>
			<div class="col-md-5">
				<hr>
				<h1>Tap on a column below to guess the card to discard.</h1>
				<center><h1 id="optimize_tag" class="card_title">Cards on Hand</h1></center>				
				<table id="current_cards_table" class="table table-bordered" style='text-align:center;'>
					<tbody>
						<tr></tr>
						<tr></tr>
					</tbody>
				</table>
			</div>
			<div class="col-md-3">
				<div class="row">
					<center><h1 id="card_selected" class="card_title"></h1></center>
				</div>
			</div>
		</div>

		<div class="row">
			<br>
			<button id="optimize_button" type="button" class="btn btn-success next_card_button">Check Result!</button>
		</div>

		<div class="row">
			<br>
			<center><h1 id='practice_optimization_result' class="card_title"></h1></center>
		</div>

		<div class="row">
			<center><h1 id="optimize_tag" class="card_title">Optimization Results</h1></center>	
			<table id="optimization_results" class="table table-striped table-bordered" style="text-align:center;">
				<thead>
					<tr>
						<th>Discard</th>
						<th>Score</th>
						<th>Hand</th>
						<th>Crib</th>
						<th>Min</th>
						<th>Max</th>
					</tr>
				</thead>
				<tbody>
					<tr></tr>
					<tr></tr>
					<tr></tr>
					<tr></tr>
					<tr></tr>
				</tbody>
			</table>
			<center><a id='column_descrips_title' class="card_title">See Column Descriptions</a></center>
			<ul id='column_descrips_list' class="card_title">
				<li><strong>Discard:</strong> Card to throw in the crib.</li>
				<li><strong>Score:</strong> The net expected score including the crib impact.</li>
				<li><strong>Crib:</strong> The impact of the discarded card thrown in the crib compared to the expected crib score.</li>
				<li><strong>Min|Max:</strong> The minimum|maximum possible score of the hand if card is discarded.</li>
			</ul>
		</div>

		<div class="row">
			<hr>
			<h1>How are you doing in discarding cards?</h1>
			<table id="progress_practice_optimization" class="table table-bordered" style='text-align:center;'>
				<thead>
					<tr>
						<th>Rounds</th>
						<th>Correct</th>
						<th>PointsLost</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>0</td>
						<td>0</td>
						<td>0</td>
					</tr>
				</tbody>
			</table>
		</div>

		<br>
		<button id="restart_button_optimization" type="button" class="btn btn-warning next_card_button">Practice again with new hand</button>	
		<br><br>
		
		<br><br>
		<center><h1 id="practice_scoring_tag" class="card_title">2) Practice Hand Scoring</h1></center>
		<hr>
		<h1>Begin each round by randomizing your hand.</h1>
		<div class="row">
			<div class="btn-group" style="margin-top:0px;">
				<button id="randomize_scoring_button" type="button" class="btn btn-info" style="width:98%; margin-top:0px;">Randomize Cards</button>
			</div>
		</div>
		<div class="row">
			<div class="col-md-6">
				<center><h1 class="card_title">Cards on Hand and Cut</h1></center>				
				<table id="current_cards_table_score" class="table table-bordered" style='text-align:center;'>
					<tbody>
						<tr></tr>
						<tr></tr>
					</tbody>
				</table>
				<center><h1 class="card_title" style="font-size:40px;">*Last column is the cut</h1></center>
			</div>
			<br>
			<div class="col-md-6">
				<div class="row">
					<div class="col-xs-6">
						<div class="form-group">
					  	<input type="text" class="form-control" id="score_guess" placeholder="Enter Score">
						</div>
					</div>
					<div class="col-xs-6">
						<button id="score_button" type="button" class="btn btn-primary next_card_button">Check Score!</button>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<br>
			<center><h1 id='score_result' class="card_title" style="width:100%;">Result</h1></center>
		</div>
	
		<div class="row">
			<hr>
			<h1>How are you doing in scoring?</h1>
			<table id="progress_practice_scoring" class="table table-bordered" style='text-align:center;'>
				<thead>
					<tr>
						<th>Rounds</th>
						<th>Correct</th>
						<th>PointsDiff</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>0</td>
						<td>0</td>
						<td>0</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<hr>
	<footer>
		<center>
	  	<p class="footer_text">Copyright &copy; 2017 [CribAppName].</p>
	  	<p class="footer_text">All rights reserved.</p>
	  </center>
	</footer>
	<br>

	<script src="js/score.js"></script>
	<script src="js/optimize.js"></script>

	<script type="text/javascript">

		/*
		TODO: Add a demo video
		*/

		/* FUNCTIONS */		
		function get_current_nums() {
			var out = [];
			for (i=1; i<=5; i++) {
				out.push($('#current_cards_table tbody tr:nth-child(1) td:nth-child(' + i + ')').text());
			}
			return out;
		}
		function get_current_suits_abbrev() {
			var out = [];
			for (i=1; i<=5; i++) {
				out.push($('#current_cards_table tbody tr:nth-child(2) td:nth-child(' + i + ')').text());
			}
			return out;
		}
		function get_current_nums_score() {
			var out = [];
			for (i=1; i<=5; i++) {
				out.push($('#current_cards_table_score tbody tr:nth-child(1) td:nth-child(' + i + ')').text());
			}
			return out;
		}
		function get_current_suits_abbrev_score() {
			var out = [];
			for (i=1; i<=5; i++) {
				out.push($('#current_cards_table_score tbody tr:nth-child(2) td:nth-child(' + i + ')').text());
			}
			return out;
		}		

		function build_current_cards_table() {
			$('#current_cards_table tbody tr:nth-child(1)').empty();
			$('#current_cards_table tbody tr:nth-child(2)').empty();
			var current_nums = get_current_nums();
			var current_suits = get_current_suits_abbrev();
			var fh = [];

			for (i in current_nums) {
				fh.push(current_nums[i].concat('-').concat(current_suits[i]));
				$('#current_cards_table tbody tr:nth-child(1)').append('<td>' + current_nums[i] + '</td>');
			}
			for (i in current_nums) {
				if (i < 4) {
					$('#current_cards_table tbody tr:nth-child(2)').append('<td>' + current_suits[i] + '</td>');
				}
			}
			if (!$("suits_matter_checkbox").is(':checked')) {
				var suits = ['S','H','C','D'];
				var fh_tmp = fh.slice();
				fh_tmp.splice(-1,1)
				var n = 0;
				while (fh_tmp.indexOf(current_nums[4].concat('-').concat(current_suits[4])) > -1) {
					$("#frame_card5_suit img").removeClass("active_suit");
					$("#frame_card5_suit img:eq(" + (n+1) + ")").addClass('active_suit');
					current_suits[4] = suits[(n+1)%4];
					n++;
					if (n>6) {
						$("#frame_card5_suit img").removeClass("active_suit");
						$("#frame_card5_suit img:eq(0)").addClass('active_suit');
						current_suits[4] = suits[0];
						break;
					}
				}
			}
			$('#current_cards_table tbody tr:nth-child(2)').append('<td>' + current_suits[4] + '</td>');	
		}

		function build_optimization_res_table(optimization_results) {
			$('#optimization_results tbody tr:nth-child(1)').empty();
			$('#optimization_results tbody tr:nth-child(2)').empty();
			$('#optimization_results tbody tr:nth-child(3)').empty();
			$('#optimization_results tbody tr:nth-child(4)').empty();
			$('#optimization_results tbody tr:nth-child(5)').empty();
			for (i in optimization_results[0]) {
				$('#optimization_results tbody tr:nth-child(1)').append('<td>' + optimization_results[0][i] + '</td>');
			}
			for (i in optimization_results[1]) {
				$('#optimization_results tbody tr:nth-child(2)').append('<td>' + optimization_results[1][i] + '</td>');
			}
			for (i in optimization_results[2]) {
				$('#optimization_results tbody tr:nth-child(3)').append('<td>' + optimization_results[2][i] + '</td>');
			}
			for (i in optimization_results[3]) {
				$('#optimization_results tbody tr:nth-child(4)').append('<td>' + optimization_results[3][i] + '</td>');
			}
			for (i in optimization_results[4]) {
				$('#optimization_results tbody tr:nth-child(5)').append('<td>' + optimization_results[4][i] + '</td>');
			}
		}

		function randomize_optimization() {
			$('#current_cards_table tbody tr:nth-child(1)').empty();
			$('#current_cards_table tbody tr:nth-child(2)').empty();
			$('#card_selected').text('');
			$('#practice_optimization_result').text('');
			$('#optimization_results tbody tr:nth-child(1)').empty();
			$('#optimization_results tbody tr:nth-child(2)').empty();
			$('#optimization_results tbody tr:nth-child(3)').empty();
			$('#optimization_results tbody tr:nth-child(4)').empty();
			$('#optimization_results tbody tr:nth-child(5)').empty();

			var full_num_idx = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
			var full_suit_idx = [0, 1, 2, 3];
			var full_names = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
			var full_suits = ['S', 'H', 'C', 'D'];

			var fh = [];
			var is_card_chosen = false;

			var rand_num_idx_arr = [];
			var rand_suit_idx_arr = [];

			for (var i=1; i<6; i++) {
				while(!is_card_chosen) {
					var rand_num_idx = Math.floor(Math.random() * 12);
					var rand_suit_idx = Math.floor(Math.random() * 3);
					var rand_num_suit = full_num_idx[rand_num_idx].toString().concat('-')
																.concat(full_suit_idx[rand_suit_idx].toString());
					if (fh.indexOf(rand_num_suit) === -1) {
						rand_num_idx_arr.push(rand_num_idx);
						rand_suit_idx_arr.push(rand_suit_idx);
						fh.push(rand_num_suit);
						is_card_chosen = true;
					}
				}
				is_card_chosen = false;
			}

			var tmp = find_indices_ordered(rand_num_idx_arr);
			for (p in tmp) {
				$('#current_cards_table tbody tr:nth-child(1)').append('<td>' + full_names[rand_num_idx_arr[tmp[p]]] + '</td>');
			}
			for (p in tmp) {
				$('#current_cards_table tbody tr:nth-child(2)').append('<td>' + full_suits[rand_suit_idx_arr[tmp[p]]] + '</td>');
			}

			if (Math.random() < 0.5) {
				$("#crib_radio1").click();	
			} else {
				$("#crib_radio2").click();	
			}

			$('#current_cards_table td').click(function() {
				$('#current_cards_table td').css('background-color','#e8e8e8');
				var col_idx = $(this).parent().children().index($(this));
				$(this).css('background-color','#ffff66');
				$(this).parent().siblings().children().eq(col_idx).css('background-color','#ffff66');

				var current_num = get_current_nums()[col_idx];
				var current_suit = get_current_suits_abbrev()[col_idx];
				$('#card_selected').text('Card Selected: ' + current_num + current_suit);
			});

			new_cards_optimization = true;
		}

		function randomize_score() {
			$('#current_cards_table_score tbody tr:nth-child(1)').empty();
			$('#current_cards_table_score tbody tr:nth-child(2)').empty();
			$('#score_guess').val('');
			$('#score_result').text('Result');

			var full_num_idx = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
			var full_suit_idx = [0, 1, 2, 3];
			var full_names = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
			var full_suits = ['S', 'H', 'C', 'D'];

			var fh = [];
			var is_card_chosen = false;

			var rand_num_idx_arr = [];
			var rand_suit_idx_arr = [];

			for (var i=1; i<6; i++) {
				while(!is_card_chosen) {
					var rand_num_idx = Math.floor(Math.random() * 12);
					var rand_suit_idx = Math.floor(Math.random() * 3);
					var rand_num_suit = full_num_idx[rand_num_idx].toString().concat('-')
																.concat(full_suit_idx[rand_suit_idx].toString());
					if (fh.indexOf(rand_num_suit) === -1) {
						rand_num_idx_arr.push(rand_num_idx);
						rand_suit_idx_arr.push(rand_suit_idx);
						fh.push(rand_num_suit);
						is_card_chosen = true;
					}
				}
				is_card_chosen = false;
			}

			var tmp = find_indices_ordered(rand_num_idx_arr);
			for (p in tmp) {
				$('#current_cards_table_score tbody tr:nth-child(1)').append('<td>' + full_names[rand_num_idx_arr[tmp[p]]] + '</td>');
			}
			for (p in tmp) {
				$('#current_cards_table_score tbody tr:nth-child(2)').append('<td>' + full_suits[rand_suit_idx_arr[tmp[p]]] + '</td>');
			}

			new_cards_scoring = true;
		}

		function compute_score() {
			var score_guess = $('#score_guess').val();
			if (score_guess === '' || !(/^\d+$/.test(score_guess))) {
				swal({title:"Score guess format is not correct", type:"error", allowOutsideClick: true});
				return;
			}

			var current_nums = get_current_nums_score();
			var current_suits = get_current_suits_abbrev_score();
			
			var score = score_hand(current_nums, current_suits, current_nums[4], current_suits[4]);
			var diff = Math.abs(score_guess - score);

			var current_rounds = Number($('#progress_practice_scoring tbody tr:nth-child(1) td:nth-child(1)').text());
			var current_corrects = Number($('#progress_practice_scoring tbody tr:nth-child(1) td:nth-child(2)').text());
			var current_pointsdiff = Number($('#progress_practice_scoring tbody tr:nth-child(1) td:nth-child(3)').text());

			if (new_cards_scoring && diff === 0) {
				$('#score_result').text('Good Job. Your score is correct.');	
				$('#progress_practice_scoring tbody tr:nth-child(1) td:nth-child(1)').text(current_rounds+1);
				$('#progress_practice_scoring tbody tr:nth-child(1) td:nth-child(2)').text(current_corrects+1);
				$('#progress_practice_scoring tbody tr:nth-child(1) td:nth-child(3)').text(current_pointsdiff);
			} else if (new_cards_scoring && diff !== 0) {
				$('#score_result').text('Wrong. The correct score is ' + score + ". You're off by " + diff + '.');	
				$('#progress_practice_scoring tbody tr:nth-child(1) td:nth-child(1)').text(current_rounds+1);
				$('#progress_practice_scoring tbody tr:nth-child(1) td:nth-child(2)').text(current_corrects);
				$('#progress_practice_scoring tbody tr:nth-child(1) td:nth-child(3)').text((current_pointsdiff+diff).toFixed(1));
			} else {
			}
			new_cards_scoring = false;
		}

/*
		function init_progress() {
			if (typeof localStorage.current_rounds_opt === undefined) {
				localStorage.current_rounds_opt = 0;
				localStorage.current_corrects_opt = 0;
				localStorage.current_pointslost_opt = 0;
				localStorage.current_rounds_score = 0;
				localStorage.current_corrects_score = 0;
				localStorage.current_pointsdiff_score = 0;
			} else {
				$('#progress_practice_optimization tbody tr:nth-child(1) td:nth-child(1)').text(localStorage.current_rounds_opt);
				$('#progress_practice_optimization tbody tr:nth-child(1) td:nth-child(2)').text(localStorage.current_corrects_opt);
				$('#progress_practice_optimization tbody tr:nth-child(1) td:nth-child(3)').text(localStorage.current_pointslost_opt);
				$('#progress_practice_scoring tbody tr:nth-child(1) td:nth-child(1)').text(localStorage.current_rounds_score);
				$('#progress_practice_scoring tbody tr:nth-child(1) td:nth-child(2)').text(localStorage.current_corrects_score);
				$('#progress_practice_scoring tbody tr:nth-child(1) td:nth-child(3)').text(localStorage.current_pointsdiff_score);
			}
		}
*/

		//******************************//

		// Keep track of each round for practice
		var new_cards_optimization = false;
		var new_cards_scoring = false;

		// Add slideDown animation to Bootstrap dropdown when expanding.
	  $('.dropdown').on('show.bs.dropdown', function(e){
		  $(this).find('.dropdown-menu').first().stop(true, true).slideDown(350);
		});

	  // Add slideUp animation to Bootstrap dropdown when collapsing.
	  $('.dropdown').on('hide.bs.dropdown', function() {
	    $(this).find('.dropdown-menu').first().stop(true, true).slideUp(350);
	  });

	  $('#crib_radio1').checkboxradio();
	  $('#crib_radio2').checkboxradio();

		randomize_optimization();
		
		$('#column_descrips_title').on('click', function() {
			if ($('#column_descrips_list').css('display') === 'none') {
				$('#column_descrips_list').css('display', 'block');	
			} else {
				$('#column_descrips_list').css('display', 'none');	
			}
		});
  	
		$('#randomize_button').on('click', function() {
			randomize_optimization();
			$('html, body').animate({
		    scrollTop: $("#randomize_button").offset().top
		  }, 1000);
		});

		$('#optimize_button').on('click', function() {
			var card_selected = $('#card_selected').text().replace('Card Selected: ', '');
			if (card_selected === '') {
				swal({title:"Select a card that you think is best to discard first", type:"error", allowOutsideClick: true});
				return;
			}
			if ($('#crib_radio1').is(':checked')) {
				var optimization_res = optimize(get_current_nums(), get_current_suits_abbrev(), true);
			} else {
				var optimization_res = optimize(get_current_nums(), get_current_suits_abbrev(), false);
			}
			var opt_score = optimization_res[0][1];
			var selected_score = -1;
			for (o in optimization_res) {
				if (optimization_res[o][0] === card_selected) {
					selected_score = optimization_res[o][1];
				}
			}
			var current_rounds = Number($('#progress_practice_optimization tbody tr:nth-child(1) td:nth-child(1)').text());
			var current_corrects = Number($('#progress_practice_optimization tbody tr:nth-child(1) td:nth-child(2)').text());
			var current_pointslost = Number($('#progress_practice_optimization tbody tr:nth-child(1) td:nth-child(3)').text());
			if (new_cards_optimization && selected_score === opt_score) {
				$('#practice_optimization_result').text('Good Job. Selected Card is Optimal.');
				$('#progress_practice_optimization tbody tr:nth-child(1) td:nth-child(1)').text(current_rounds+1);
				$('#progress_practice_optimization tbody tr:nth-child(1) td:nth-child(2)').text(current_corrects+1);
				$('#progress_practice_optimization tbody tr:nth-child(1) td:nth-child(3)').text(current_pointslost);
			} else if (new_cards_optimization && selected_score !== opt_score) {
				$('#practice_optimization_result').text('Wrong. Best card to discard is ' + optimization_res[0][0] + '. You lose an expected score of ' + (opt_score-selected_score).toFixed(1));
					console.log(current_rounds);
					$('#progress_practice_optimization tbody tr:nth-child(1) td:nth-child(1)').text(current_rounds+1);
					$('#progress_practice_optimization tbody tr:nth-child(1) td:nth-child(2)').text(current_corrects);
					$('#progress_practice_optimization tbody tr:nth-child(1) td:nth-child(3)').text((current_pointslost+opt_score-selected_score).toFixed(1));
			} else {
			}

			build_optimization_res_table(optimization_res);
			$('html, body').animate({
		    scrollTop: $("#optimize_button").offset().top
		  }, 1000);

		  new_cards_optimization = false;
		});

		$('#restart_button_optimization').on('click', function() {
			randomize_optimization();
			$('html, body').animate({
		    scrollTop: $("#randomize_button").offset().top
		  }, 1000);
		});

		randomize_score();

		$('#practice_optimization_link').on('click', function() {
			$('html, body').animate({
		    scrollTop: $("#practice_optimization_link").offset().top
		  }, 1000);
		})

		$('#practice_score_link').on('click', function() {
			$('html, body').animate({
		    scrollTop: $("#practice_scoring_tag").offset().top
		  }, 1000);
		})

		$('#score_button').on('click', function() {
			compute_score();
		});

		$('#randomize_scoring_button').on('click', function() {
			randomize_score();
			$('html, body').animate({
		    scrollTop: $("#randomize_scoring_button").offset().top
		  }, 1000);
		});

	</script>


</body>


</html>

