<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Cribbage Hand Optimizer</title>

  <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

  <!-- Bootstrap -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  
  <script src="js/sly.min.js"></script>

  <script src="js/sweetalert.min.js"></script>
  <link rel="stylesheet" href="sweetalert.css">

  <link rel="stylesheet" href="style.css">

</head>

<body style="margin:0px 20px 0px 20px;">
	
	<!--<center><h1 class="card_title">Select Card One:</h1></center>-->
	<br>
	<div id="frame_card1_num" class="frame">
		<ul class="slidee"></ul>
	</div>
	<br><br>
	<div id="frame_card1_suit" class="suit">
		<div class="row">
			<div class="col-xs-3">
				<img class="active_suit" src="images/spade.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/heart.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/club.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/diamond.png" />
			</div>
		</div>
	</div>
	<br><br>
	<!--<button id="button_to_2" type="button" class="btn btn-default next_card_button">Next Card</button>-->
	<hr>

	<!--<center><h1 id="card_title2" class="card_title">Select Card Two:</h1></center>-->
	<br>
	<div id="frame_card2_num" class="frame">
		<ul class="slidee"></ul>
	</div>
	<br><br>
	<div id="frame_card2_suit" class="suit">
		<div class="row">
			<div class="col-xs-3">
				<img src="images/spade.png"/>
			</div>
			<div class="col-xs-3">
				<img class="active_suit" src="images/heart.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/club.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/diamond.png" />
			</div>
		</div>
	</div>
	<br><br>
	<!--<button id="button_to_3" type="button" class="btn btn-default next_card_button">Next Card</button>-->
	<hr>

	<!--<center><h1 id="card_title3" class="card_title">Select Card Three:</h1></center>-->
	<br>
	<div id="frame_card3_num" class="frame">
		<ul class="slidee"></ul>
	</div>
	<br><br>
	<div id="frame_card3_suit" class="suit">
		<div class="row">
			<div class="col-xs-3">
				<img src="images/spade.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/heart.png" />
			</div>
			<div class="col-xs-3">
				<img class="active_suit" src="images/club.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/diamond.png" />
			</div>
		</div>
	</div>
	<br><br>
	<!--<button id="button_to_4" type="button" class="btn btn-default next_card_button">Next Card</button>-->
	<hr>

	<!--<center><h1 id="card_title4" class="card_title">Select Card Four:</h1></center>-->
	<br>
	<div id="frame_card4_num" class="frame">
		<ul class="slidee"></ul>
	</div>
	<br><br>
	<div id="frame_card4_suit" class="suit">
		<div class="row">
			<div class="col-xs-3">
				<img src="images/spade.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/heart.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/club.png" />
			</div>
			<div class="col-xs-3">
				<img class="active_suit" src="images/diamond.png" />
			</div>
		</div>
	</div>
	<br><br>
	<!--<button id="button_to_5" type="button" class="btn btn-default next_card_button">Next Card</button>-->
	<hr>

	<!--<center><h1 id="card_title5" class="card_title">Select Card Five:</h1></center>-->
	<br>
	<div id="frame_card5_num" class="frame">
		<ul class="slidee"></ul>
	</div>
	<br><br>
	<div id="frame_card5_suit" class="suit">
		<div class="row">
			<div class="col-xs-3">
				<img src="images/spade.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/heart.png" />
			</div>
			<div class="col-xs-3">
				<img class="active_suit" src="images/club.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/diamond.png" />
			</div>
		</div>
	</div>
	<br><br>
	<button id="button_to_optimize" type="button" class="btn btn-default next_card_button">Go to optimize</button>
	<hr>

	<center><h1 id="optimize_tag" class="card_title">Current Cards</h1></center>
	<table id="current_cards_table" class="table table-bordered" style='text-align:center;'>
		<tbody>
			<tr></tr>
			<tr></tr>
		</tbody>
	</table>

	<center>
		<div class="radio">
		  <label><input type="radio" name="optradio" value=1>Your Crib</label>
		</div>
		<div class="radio">
		  <label><input type="radio" name="optradio" value=0>Opponent's Crib</label>
		</div>
	</center>

	<button id="optimize_button" type="button" class="btn btn-default next_card_button">Optimize!</button>

	<hr>

	<table id="optimization_results" class="table table-striped table-bordered" style="text-align:center;">
		<thead>
			<tr>
				<th>Throw</th>
				<th>Score</th>
				<th>Hand</th>
				<th>Crib</th>
			</tr>
		</thead>
		<tbody>
			<tr></tr>
			<tr></tr>
			<tr></tr>
		</tbody>
	</table>

	<hr>

	<center><h4>What card was cut?</h4></center>
	<div id="frame_cut_num" class="frame">
		<ul class="slidee"></ul>
	</div>
	<br>
	<div id="frame_cut_suit" class="suit">
		<div class="row">
			<div class="col-xs-3">
				<img src="images/spade.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/heart.png" />
			</div>
			<div class="col-xs-3">
				<img class="active_suit" src="images/club.png" />
			</div>
			<div class="col-xs-3">
				<img src="images/diamond.png" />
			</div>
		</div>
	</div>

	<hr>
	<button id="score_button" type="button" class="btn btn-default next_card_button">Compute Scores!</button>

	<br><br>
	<table id="scores_results" class="table table-striped table-bordered" style="text-align:center;">
		<thead>
			<tr>
				<th>Throw</th>
				<th>Hand Score</th>
			</tr>
		</thead>
		<tbody>
			<tr></tr>
			<tr></tr>
			<tr></tr>
			<tr></tr>
			<tr></tr>
		</tbody>
	</table>

	<hr>
	<button id="restart_button" type="button" class="btn btn-default next_card_button">Restart Round</button>	

	<br>
	<hr>

	<script src="js/score.js"></script>
	<script src="js/optimize.js"></script>

	<script type="text/javascript">
		
		var card_nums = ['A', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

		// Append card nums
		for (c in card_nums) { $('#frame_card1_num ul').append('<li>' + card_nums[c] + '</li>'); }
		for (c in card_nums) { $('#frame_card2_num ul').append('<li>' + card_nums[c] + '</li>'); }
		for (c in card_nums) { $('#frame_card3_num ul').append('<li>' + card_nums[c] + '</li>'); }
		for (c in card_nums) { $('#frame_card4_num ul').append('<li>' + card_nums[c] + '</li>'); }
		for (c in card_nums) { $('#frame_card5_num ul').append('<li>' + card_nums[c] + '</li>'); }
		for (c in card_nums) { $('#frame_cut_num ul').append('<li>' + card_nums[c] + '</li>'); }

		var options_card = { horizontal: 1,
							    	itemNav: 'forceCentered',
							    	smart: 1,
							    	startAt: 7,
							    	activateOn: 'click',
							    	activateMiddle: 1,
							    	scrollBy: 1,
							    	speed: 300,
							    	mouseDragging: 1,
							    	touchDragging: 1,
							    	releaseSwing: 1 };	

		var frame_card1_num = new Sly('#frame_card1_num', options_card).init();
		var frame_card2_num = new Sly('#frame_card2_num', options_card).init();
		var frame_card3_num = new Sly('#frame_card3_num', options_card).init();
		var frame_card4_num = new Sly('#frame_card4_num', options_card).init();
		options_card['startAt'] = 8;
		var frame_card5_num = new Sly('#frame_card5_num', options_card).init();

		options_card['startAt'] = 6
		var frame_cut_num = new Sly('#frame_cut_num', options_card).init();

		$('#frame_card1_suit img').on('click', function() {
			$("#frame_card1_suit img").removeClass("active_suit");
			$(this).addClass('active_suit');
		});
		$('#frame_card2_suit img').on('click', function() {
			$("#frame_card2_suit img").removeClass("active_suit");
			$(this).addClass('active_suit');
		});
		$('#frame_card3_suit img').on('click', function() {
			$("#frame_card3_suit img").removeClass("active_suit");
			$(this).addClass('active_suit');
		});
		$('#frame_card4_suit img').on('click', function() {
			$("#frame_card4_suit img").removeClass("active_suit");
			$(this).addClass('active_suit');
		});
		$('#frame_card5_suit img').on('click', function() {
			$("#frame_card5_suit img").removeClass("active_suit");
			$(this).addClass('active_suit');
		});
		$('#frame_cut_suit img').on('click', function() {
			$("#frame_cut_suit img").removeClass("active_suit");
			$(this).addClass('active_suit');
		});

		$("#button_to_2").click(function() {
	    $('html, body').animate({
	        scrollTop: $("#card_title2").offset().top
	    }, 1000);
		});
		$("#button_to_3").click(function() {
	    $('html, body').animate({
	        scrollTop: $("#card_title3").offset().top
	    }, 1000);
		});
		$("#button_to_4").click(function() {
	    $('html, body').animate({
	        scrollTop: $("#card_title4").offset().top
	    }, 1000);
		});
		$("#button_to_5").click(function() {
	    $('html, body').animate({
	        scrollTop: $("#card_title5").offset().top
	    }, 1000);
		});
		$('#button_to_optimize').click(function() {
		  $('html, body').animate({
	      scrollTop: $("#optimize_tag").offset().top
	    }, 1000);
		});

		function get_current_nums() {
			var out = [];
			for (i=1; i<=5; i++) {
				out.push($('#frame_card' + i + '_num .active').text());
			}
			return out;
		}

		function get_current_suits() {
			var out = [];
			for (i=1; i<=5; i++) {
				out.push($('#frame_card' + i + '_suit .active_suit')[0].src
											.replace(/^.*[\\\/]/, '').slice(0,-4));
			}
			return out;
		}

		function get_current_suits_abbrev() {
			var out = [];
			for (i=1; i<=5; i++) {
				out.push($('#frame_card' + i + '_suit .active_suit')[0].src
											.replace(/^.*[\\\/]/, '').slice(0,-4)
											.slice(0,1).toUpperCase());
			}
			return out;	
		}

		function build_current_cards_table() {
			$('#current_cards_table tbody tr:nth-child(1)').empty();
			$('#current_cards_table tbody tr:nth-child(2)').empty();
			var current_nums = get_current_nums();
			var current_suits = get_current_suits_abbrev();
			for (i in current_nums) {
				$('#current_cards_table tbody tr:nth-child(1)').append('<td>' + current_nums[i] + '</td>');
			}
			for (i in current_nums) {
				$('#current_cards_table tbody tr:nth-child(2)').append('<td>' + current_suits[i] + '</td>');
			}
		}
		build_current_cards_table();

		frame_card1_num.on('active', build_current_cards_table);
		frame_card2_num.on('active', build_current_cards_table);
		frame_card3_num.on('active', build_current_cards_table);
		frame_card4_num.on('active', build_current_cards_table);
		frame_card5_num.on('active', build_current_cards_table);

		function build_optimization_res_table(optimization_results) {
			$('#optimization_results tbody tr:nth-child(1)').empty();
			$('#optimization_results tbody tr:nth-child(2)').empty();
			$('#optimization_results tbody tr:nth-child(3)').empty();
			for (i in optimization_results[0]) {
				$('#optimization_results tbody tr:nth-child(1)').append('<td>' + optimization_results[0][i] + '</td>');
			}
			for (i in optimization_results[1]) {
				$('#optimization_results tbody tr:nth-child(2)').append('<td>' + optimization_results[1][i] + '</td>');
			}
			for (i in optimization_results[2]) {
				$('#optimization_results tbody tr:nth-child(3)').append('<td>' + optimization_results[2][i] + '</td>');
			}
		}

		$('#optimize_button').on('click', function() {
			/*
			swal({
			  title: "Optimize!",
			  text: "Who's crib is it?",
			  showCancelButton: true,
			  confirmButtonColor: "#00e500",
			  cancelButtonColor: "#e50000",
			  confirmButtonText: "It's mine",
			  cancelButtonText: "Not mine",
			  closeOnConfirm: true,
			  closeOnCancel: true,
			  allowOutsideClick: true,
			  showLoaderOnConfirm: true
			},
			function(isConfirm){
			  if (isConfirm) {
			    var optimization_res = optimize(get_current_nums(), get_current_suits_abbrev(), true);
			    build_optimization_res_table(optimization_res);
			  } else {
			    var optimization_res = optimize(get_current_nums(), get_current_suits_abbrev(), false);
			    build_optimization_res_table(optimization_res);
			  }
			});
			*/
			if ($('input[name=optradio]:checked').val() === "1") {
				var optimization_res = optimize(get_current_nums(), get_current_suits_abbrev(), true);
			  build_optimization_res_table(optimization_res);
		    $('html, body').animate({
		        scrollTop: $("#optimization_results").offset().top
		    }, 1000);
			} else if ($('input[name=optradio]:checked').val() === "0") {
				var optimization_res = optimize(get_current_nums(), get_current_suits_abbrev(), false);
			  build_optimization_res_table(optimization_res);
			  $('html, body').animate({
		        scrollTop: $("#optimization_results").offset().top
		    }, 1000);
			} else {
				swal({title:"Who's crib is it?", type:"error", allowOutsideClick: true});
			}
		});

		$('#score_button').on('click', function() {
			var current_nums = get_current_nums();
			var current_suits = get_current_suits_abbrev();

			var cut_num = $('#frame_cut_num .active').text();
			var cut_suit = $('#frame_cut_suit .active_suit')[0].src.replace(/^.*[\\\/]/, '').slice(0,-4);

			var score1 = score_hand([cut_num].concat(current_nums.slice(1)), 
											[cut_suit].concat(current_suits.slice(1)), cut_suit);
			var score2 = score_hand([cut_num].concat(current_nums.slice(0,1).concat(current_nums.slice(2))),
												[cut_suit].concat(current_suits.slice(0,1).concat(current_suits.slice(2))), cut_suit);
			var score3 = score_hand([cut_num].concat(current_nums.slice(0,2).concat(current_nums.slice(3))),
												[cut_suit].concat(current_suits.slice(0,2).concat(current_suits.slice(3))), cut_suit);
			var score4 = score_hand([cut_num].concat(current_nums.slice(0,3).concat(current_nums.slice(4))),
												[cut_suit].concat(current_suits.slice(0,3).concat(current_suits.slice(4))), cut_suit);
			var score5 = score_hand([cut_num].concat(current_nums.slice(0,4)), 
											[cut_suit].concat(current_suits.slice(0,4)), cut_suit);			

			$('#scores_results tbody tr:nth-child(1)')
					.append('<td>' + current_nums[0] + current_suits[0] + '</td>' + '<td>' + score1 + "</td>");
			$('#scores_results tbody tr:nth-child(2)')
					.append('<td>' + current_nums[1] + current_suits[1] + '</td>' + '<td>' + score2 + "</td>");
			$('#scores_results tbody tr:nth-child(3)')
					.append('<td>' + current_nums[2] + current_suits[2] + '</td>' + '<td>' + score3 + "</td>");
			$('#scores_results tbody tr:nth-child(4)')
					.append('<td>' + current_nums[3] + current_suits[3] + '</td>' + '<td>' + score4 + "</td>");
			$('#scores_results tbody tr:nth-child(5)')
					.append('<td>' + current_nums[4] + current_suits[4] + '</td>' + '<td>' + score5 + "</td>");
		});

		$('#restart_button').on('click', function() {
			$('html, body').animate({ scrollTop: 0 }, 'fast');
			window.location.reload(false); 
		});

	</script>


</body>


</html>


